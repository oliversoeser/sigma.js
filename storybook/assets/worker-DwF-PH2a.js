import{g as X}from"./_commonjsHelpers-BosuxZz1.js";import{i as Y}from"./utils-8yT8BWPw.js";import{g as $,d as L}from"./defaults-9mJNxk8k.js";const{createNodeValueGetter:G,createEdgeValueGetter:j}=$;var K=function(s,i,c){const{nodeXAttribute:E,nodeYAttribute:b}=c,{attraction:d,repulsion:l,gravity:w,inertia:N,maxMove:F}=c.settings;let{shouldSkipNode:m,shouldSkipEdge:A,isNodeFixed:C}=c;C=G(C),m=G(m,!1),A=j(A,!1);const y=s.filterNodes((e,o)=>!m.fromEntry(e,o)),v=y.length;for(let e=0;e<v;e++){const o=y[e],t=s.getNodeAttributes(o),n=i[o];n?i[o]={dx:n.dx*N,dy:n.dy*N,x:t[E]||0,y:t[b]||0}:i[o]={dx:0,dy:0,x:t[E]||0,y:t[b]||0}}if(l)for(let e=0;e<v;e++){const o=y[e],t=i[o];for(let n=e+1;n<v;n++){const u=y[n],a=i[u],k=a.x-t.x,f=a.y-t.y,h=Math.sqrt(k*k+f*f)||1,x=l/h*k,g=l/h*f;t.dx-=x,t.dy-=g,a.dx+=x,a.dy+=g}}if(d&&s.forEachEdge((e,o,t,n,u,a,k)=>{if(t===n||m.fromEntry(t,u)||m.fromEntry(n,a)||A.fromEntry(e,o,t,n,u,a,k))return;const f=i[t],h=i[n],x=h.x-f.x,g=h.y-f.y,S=Math.sqrt(x*x+g*g)||1,M=d*S*x,q=d*S*g;f.dx+=M,f.dy+=q,h.dx-=M,h.dy-=q}),w)for(let e=0;e<v;e++){const o=y[e],t=i[o],{x:n,y:u}=t,a=Math.sqrt(n*n+u*u)||1;i[o].dx-=n*w*a,i[o].dy-=u*w*a}const I=!1;for(let e=0;e<v;e++){const o=y[e],t=i[o],n=Math.sqrt(t.dx*t.dx+t.dy*t.dy);n>F&&(t.dx*=F/n,t.dy*=F/n),C.fromGraph(s,o)?t.fixed=!0:(t.x+=t.dx,t.y+=t.dy,t.fixed=!1)}return{converged:I}},D={};D.assignLayoutChanges=function(r,s,i){const{nodeXAttribute:c,nodeYAttribute:E}=i;r.updateEachNodeAttributes((b,d)=>{const l=s[b];return!l||l.fixed||(d[c]=l.x,d[E]=l.y),d},{attributes:["x","y"]})};D.collectLayoutChanges=function(r){const s={};for(const i in r){const c=r[i];s[i]={x:c.x,y:c.y}}return s};var V={nodeXAttribute:"x",nodeYAttribute:"y",isNodeFixed:"fixed",shouldSkipNode:null,shouldSkipEdge:null,settings:{attraction:5e-4,repulsion:.1,gravity:1e-4,inertia:.6,maxMove:200}};const O=Y,R=L,T=K,U=D,z=V;function p(r,s){if(!O(r))throw new Error("graphology-layout-force/worker: the given graph is not a valid graphology instance.");s=R(s,z),this.callbacks={},s.onConverged&&(this.callbacks.onConverged=s.onConverged),this.graph=r,this.params=s,this.nodeStates={},this.frameID=null,this.running=!1,this.killed=!1}p.prototype.isRunning=function(){return this.running};p.prototype.runFrame=function(){let{converged:r}=T(this.graph,this.nodeStates,this.params);U.assignLayoutChanges(this.graph,this.nodeStates,this.params),r=!1,r?(this.callbacks.onConverged&&this.callbacks.onConverged(),this.stop()):this.frameID=window.requestAnimationFrame(()=>this.runFrame())};p.prototype.stop=function(){return this.running=!1,this.frameID!==null&&(window.cancelAnimationFrame(this.frameID),this.frameID=null),this};p.prototype.start=function(){if(this.killed)throw new Error("graphology-layout-force/worker.start: layout was killed.");this.running||(this.running=!0,this.runFrame())};p.prototype.kill=function(){this.stop(),delete this.nodeStates,this.killed=!0};var B=p;const Q=X(B);export{Q as F};
